{% extends "base.html" %}

{% block title %}Student Dashboard - {{ student.name }}{% endblock %}

{% block page_title %}My Academic Dashboard{% endblock %}
{% block page_subtitle %}Your complete performance and engagement overview{% endblock %}
{% block header_actions %}{% endblock %} {# Remove admin buttons #}

{% block content %}

<div class="risk-alert-container mb-4">
    {% if student.risk_level == 'Red' %}
    <div class="risk-alert risk-critical">
        <div class="risk-content">
            <h2 class="risk-title">üö® CRITICAL: Immediate Attention Required</h2>
            <p><strong>Issues Identified:</strong> {{ student.risk_reason }}</p>
            <p><strong>AI Risk Score:</strong> {{ student.ml_risk_score|round(1) }}%</p>
        </div>
    </div>
    {% elif student.risk_level == 'Yellow' %}
    <div class="risk-alert risk-warning">
        <div class="risk-content">
            <h2 class="risk-title">‚ö†Ô∏è WARNING: Action Recommended</h2>
            <p><strong>Areas for Improvement:</strong> {{ student.risk_reason }}</p>
            <p><strong>AI Risk Score:</strong> {{ student.ml_risk_score|round(1) }}%</p>
        </div>
    </div>
    {% else %}
    <div class="risk-alert risk-safe">
        <div class="risk-content">
            <h2 class="risk-title">‚úÖ EXCELLENT: You're On Track!</h2>
            <p><strong>Status:</strong> {{ student.risk_reason }}</p>
            <p><strong>AI Risk Score:</strong> {{ student.ml_risk_score|round(1) }}%</p>
        </div>
    </div>
    {% endif %}
</div>

<div class="stats-grid mb-4">
    <div class="stat-card">
        <div class="stat-header"><span class="stat-title">Attendance Rate</span></div>
        <div class="stat-value">{{ student.attendance }}%</div>
    </div>
    <div class="stat-card">
        <div class="stat-header"><span class="stat-title">Average Mark</span></div>
        <div class="stat-value">{{ "%.1f"|format(student.Avg_Performance) }}</div>
    </div>
    <div class="stat-card">
        <div class="stat-header"><span class="stat-title">Semester GPA</span></div>
        <div class="stat-value">{{ student.Semester_GPA }}</div>
    </div>
    <div class="stat-card">
        <div class="stat-header"><span class="stat-title">Overall Status</span></div>
        <div class="stat-value"><span class="status-badge {{ student.risk_level.lower() }}">{{ student.risk_level }}</span></div>
    </div>
</div>

<div class="details-grid">
    <div class="data-table-container">
        <div class="table-header"><h3 class="table-title">üë§ Personal & Academic</h3></div>
        <div class="details-content">
            <div class="detail-row"><span class="detail-label">Student ID</span><span>{{ student.student_id }}</span></div>
            <div class="detail-row"><span class="detail-label">Email</span><span>{{ student.email }}</span></div>
            <div class="detail-row"><span class="detail-label">Age</span><span>{{ student.Age }}</span></div>
            <div class="detail-row"><span class="detail-label">Gender</span><span>{{ student.Gender }}</span></div>
            <div class="detail-row"><span class="detail-label">Year of Study</span><span>{{ student.Year_of_Study }}</span></div>
        </div>
    </div>

    <div class="data-table-container">
        <div class="table-header"><h3 class="table-title">üìö Subject-wise Performance</h3></div>
        <div class="details-content">
            <div class="detail-row"><span class="detail-label">Mathematics</span><span class="marks-value {% if student.Marks_Math >= 60 %}marks-good{% elif student.Marks_Math >= 40 %}marks-warning{% else %}marks-poor{% endif %}">{{ student.Marks_Math }}</span></div>
            <div class="detail-row"><span class="detail-label">Physics</span><span class="marks-value {% if student.Marks_Physics >= 60 %}marks-good{% elif student.Marks_Physics >= 40 %}marks-warning{% else %}marks-poor{% endif %}">{{ student.Marks_Physics }}</span></div>
            <div class="detail-row"><span class="detail-label">Chemistry</span><span class="marks-value {% if student.Marks_Chemistry >= 60 %}marks-good{% elif student.Marks_Chemistry >= 40 %}marks-warning{% else %}marks-poor{% endif %}">{{ student.Marks_Chemistry }}</span></div>
            <div class="detail-row"><span class="detail-label">Computer Science</span><span class="marks-value {% if student.Marks_CS >= 60 %}marks-good{% elif student.Marks_CS >= 40 %}marks-warning{% else %}marks-poor{% endif %}">{{ student.Marks_CS }}</span></div>
            <div class="detail-row"><span class="detail-label">Lab 1</span><span class="marks-value {% if student.Marks_Lab1 >= 60 %}marks-good{% elif student.Marks_Lab1 >= 40 %}marks-warning{% else %}marks-poor{% endif %}">{{ student.Marks_Lab1 }}</span></div>
            <div class="detail-row"><span class="detail-label">Lab 2</span><span class="marks-value {% if student.Marks_Lab2 >= 60 %}marks-good{% elif student.Marks_Lab2 >= 40 %}marks-warning{% else %}marks-poor{% endif %}">{{ student.Marks_Lab2 }}</span></div>
        </div>
    </div>

    <div class="data-table-container">
        <div class="table-header"><h3 class="table-title">üí≥ Financial & Scholarship</h3></div>
        <div class="details-content">
            <div class="detail-row"><span class="detail-label">Fee Status</span><span>{{ student.fee_status }}</span></div>
            <div class="detail-row"><span class="detail-label">Scholarship</span><span>{{ student.Scholarship_Status }}</span></div>
            <div class="detail-row"><span class="detail-label">Loan Taken</span><span>{{ student.Loan_Status }}</span></div>
            <div class="detail-row"><span class="detail-label">Parent Annual Income</span><span>${{ student.Parent_Annual_Income|int|abs }}</span></div>
        </div>
    </div>

    <div class="data-table-container">
        <div class="table-header"><h3 class="table-title">ü©∫ Engagement & Health</h3></div>
        <div class="details-content">
            <div class="detail-row"><span class="detail-label">LMS Logins / Week</span><span>{{ student.LMS_Logins_Per_Week }}</span></div>
            <div class="detail-row"><span class="detail-label">Class Participation</span><span>{{ student.Class_Participation }}</span></div>
            <div class="detail-row"><span class="detail-label">Extracurricular Score</span><span>{{ student.Extracurricular_Activities_Score }}</span></div>
            <div class="detail-row"><span class="detail-label">Chronic Health Issue</span><span>{{ student.Chronic_Health_Issue }}</span></div>
        </div>
    </div>

    <div class="data-table-container">
        <div class="table-header"><h3 class="table-title">‚öñÔ∏è Behavioral Record</h3></div>
        <div class="details-content">
            <div class="detail-row"><span class="detail-label">Total Leaves Taken</span><span>{{ student.Total_Leaves }}</span></div>
            <div class="detail-row"><span class="detail-label">Disciplinary Actions</span><span>{{ student.Disciplinary_Actions }}</span></div>
            <div class="detail-row"><span class="detail-label">Counseling Sessions</span><span>{{ student.Counseling_Sessions_Attended }}</span></div>
        </div>
    </div>
</div>

{% endblock %}


{% block extra_css %}
<style>
.risk-alert { padding: 1.5rem; border-radius: var(--radius); }
.risk-critical { background: rgba(239, 68, 68, 0.1); border-left: 4px solid var(--accent-danger); }
.risk-warning { background: rgba(245, 158, 11, 0.1); border-left: 4px solid var(--accent-warning); }
.risk-safe { background: rgba(16, 185, 129, 0.1); border-left: 4px solid var(--accent-success); }
.risk-content h2 { margin: 0 0 0.5rem 0; font-size: 1.25rem; }
.risk-content p { margin: 0; color: var(--text-secondary); }

.details-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 1.5rem;
}
.details-content { padding: 1rem; }
.detail-row {
    display: flex;
    justify-content: space-between;
    padding: 0.75rem;
    font-size: 0.875rem;
    border-bottom: 1px solid var(--border);
}
.detail-row:last-child { border: none; }
.detail-label { color: var(--text-muted); }
.detail-row span:last-child { font-weight: 600; }
</style>
{% endblock %}